---
layout: base
---
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  {%- assign all_experiences = site.experiences -%}
  {%- assign sorted_experiences = "" | split: "" -%}
  {%- for i in (0..999) -%}
    {%- assign found_experience = null -%}
    {%- assign latest_date = null -%}
    {%- for experience in all_experiences -%}
      {%- assign already_sorted = false -%}
      {%- for sorted_exp in sorted_experiences -%}
        {%- if sorted_exp.path == experience.path -%}
          {%- assign already_sorted = true -%}
          {%- break -%}
        {%- endif -%}
      {%- endfor -%}
      {%- unless already_sorted -%}
        {%- assign experience_path_parts = experience.path | split: '/' -%}
        {%- assign experience_filename = experience_path_parts | last | split: '.' | first -%}
        {%- assign experience_roles = "" | split: "" -%}
        {%- for role in site.roles -%}
          {%- assign role_path_parts = role.path | split: '/' -%}
          {%- if role_path_parts.size > 2 -%}
            {%- assign role_directory = role_path_parts[1] -%}
            {%- if role_directory == experience_filename -%}
              {%- assign experience_roles = experience_roles | push: role -%}
            {%- endif -%}
          {%- endif -%}
        {%- endfor -%}
        {%- assign earliest_start = null -%}
        {%- for role in experience_roles -%}
          {%- if role.start_date -%}
            {%- if earliest_start == null -%}
              {%- assign earliest_start = role.start_date -%}
            {%- else -%}
              {%- assign role_start_epoch = role.start_date | date: "%s" | plus: 0 -%}
              {%- assign earliest_start_epoch = earliest_start | date: "%s" | plus: 0 -%}
              {%- if role_start_epoch < earliest_start_epoch -%}
                {%- assign earliest_start = role.start_date -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endfor -%}
        {%- if earliest_start -%}
          {%- assign earliest_start_epoch = earliest_start | date: "%s" | plus: 0 -%}
          {%- if latest_date == null or earliest_start_epoch > latest_date -%}
            {%- assign latest_date = earliest_start_epoch -%}
            {%- assign found_experience = experience -%}
          {%- endif -%}
        {%- else -%}
          {%- if latest_date == null -%}
            {%- assign found_experience = experience -%}
          {%- endif -%}
        {%- endif -%}
      {%- endunless -%}
    {%- endfor -%}
    {%- if found_experience -%}
      {%- assign sorted_experiences = sorted_experiences | push: found_experience -%}
    {%- else -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}
  {%- for experience in sorted_experiences -%}
    {%- if experience.url == page.url -%}
      {%- assign current_index = forloop.index0 -%}
      {%- assign previous_index = current_index | plus: 1 -%}
      {%- assign next_index = current_index | minus: 1 -%}
      {%- if previous_index < sorted_experiences.size -%}
        {%- assign previous_experience = sorted_experiences[previous_index] -%}
      {%- endif -%}
      {%- if next_index >= 0 -%}
        {%- assign next_experience = sorted_experiences[next_index] -%}
      {%- endif -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}

  <nav class="experience-navigation-top">
    <div class="experience-nav-wrapper-top">
      {%- if previous_experience -%}
        <a href="{{ previous_experience.url | relative_url }}" class="experience-nav-link-top">← Previous</a>
      {%- else -%}
        <span class="experience-nav-link-top disabled">← Previous</span>
      {%- endif -%}
      <a href="/experiences/" class="experience-nav-link-top experience-nav-link-center">All</a>
      {%- if next_experience -%}
        <a href="{{ next_experience.url | relative_url }}" class="experience-nav-link-top">Next →</a>
      {%- else -%}
        <span class="experience-nav-link-top disabled">Next →</span>
      {%- endif -%}
    </div>
  </nav>

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">{{ page.title | escape }}</h1>
    <div class="post-meta">
      {%- assign experience_path_parts = page.path | split: '/' -%}
      {%- assign experience_filename = experience_path_parts | last | split: '.' | first -%}
      {%- assign experience_roles = "" | split: "" -%}
      {%- for role in site.roles -%}
        {%- assign role_path_parts = role.path | split: '/' -%}
        {%- if role_path_parts.size > 2 -%}
          {%- assign role_directory = role_path_parts[1] -%}
          {%- if role_directory == experience_filename -%}
            {%- assign experience_roles = experience_roles | push: role -%}
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
      {%- assign earliest_start = null -%}
      {%- assign latest_end = null -%}
      {%- for role in experience_roles -%}
        {%- if role.start_date -%}
          {%- if earliest_start == null -%}
            {%- assign earliest_start = role.start_date -%}
          {%- else -%}
            {%- assign role_start_epoch = role.start_date | date: "%s" | plus: 0 -%}
            {%- assign earliest_start_epoch = earliest_start | date: "%s" | plus: 0 -%}
            {%- if role_start_epoch < earliest_start_epoch -%}
              {%- assign earliest_start = role.start_date -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {%- if role.end_date -%}
          {%- if latest_end == null -%}
            {%- assign latest_end = role.end_date -%}
          {%- else -%}
            {%- assign role_end_epoch = role.end_date | date: "%s" | plus: 0 -%}
            {%- assign latest_end_epoch = latest_end | date: "%s" | plus: 0 -%}
            {%- if role_end_epoch > latest_end_epoch -%}
              {%- assign latest_end = role.end_date -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
      {% include date-range.html start_date=earliest_start end_date=latest_end %}

      {%- if page.bio or page.link -%}
      <p>
        {{ page.bio }}
        {%- if page.link -%}  
          &nbsp;<a href="{{ page.link }}" target="_blank">{{ page.link | remove: "https://" | remove: "http://" | remove: "www." }}</a>
        {%- endif -%}
      </p>
      {%- endif -%}
    </div>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    {% include experience-roles.html %}

    {{ content }}
  </div>

  <nav class="experience-navigation">
    <div class="experience-nav-wrapper">
      {%- if previous_experience -%}
        <div class="experience-nav-item experience-nav-previous">
          <a href="{{ previous_experience.url | relative_url }}" class="experience-nav-link">
            <span class="experience-nav-label">← Previous</span>
            <span class="experience-nav-title">{{ previous_experience.title | escape }}</span>
          </a>
        </div>
      {%- else -%}
        <div class="experience-nav-item experience-nav-previous"></div>
      {%- endif -%}
      
      {%- if next_experience -%}
        <div class="experience-nav-item experience-nav-next">
          <a href="{{ next_experience.url | relative_url }}" class="experience-nav-link">
            <span class="experience-nav-label">Next →</span>
            <span class="experience-nav-title">{{ next_experience.title | escape }}</span>
          </a>
        </div>
      {%- endif -%}
    </div>
  </nav>

  {% if jekyll.environment == 'production' -%}
    {% if page.comments == false -%}
    <div class="comments-disabled-message">
      Comments have been disabled for this post.
    </div>
    {% else -%}
      {%- include comments.html -%}
    {% endif -%}
  {% endif -%}

  <a class="u-url" href="{{ page.url | relative_url }}" hidden></a>
</article>