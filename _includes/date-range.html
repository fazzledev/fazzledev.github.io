{%- assign date_format = site.minima.date_format | default: "%b '%y" -%}
{%- assign start_date = include.start_date | date_to_xmlschema -%}
{%- assign start_epoch = include.start_date | date: "%s" | plus: 0 -%}
{%- if include.end_date -%}
  {%- assign end_date_parsed = include.end_date | date_to_xmlschema -%}
  {%- assign end_epoch = include.end_date | date: "%s" | plus: 0 -%}
{%- else -%}
  {%- assign end_epoch = site.time | date: "%s" | plus: 0 -%}
{%- endif -%}
{%- if end_epoch > 0 and start_epoch > 0 -%}
  {%- assign duration_seconds = end_epoch | minus: start_epoch -%}
  {%- if duration_seconds > 0 -%}
    {%- assign start_year = include.start_date | date: "%Y" | plus: 0 -%}
    {%- assign start_month_str = include.start_date | date: "%m" -%}
    {%- assign start_month = start_month_str | plus: 0 -%}
    {%- if include.end_date -%}
      {%- assign end_year = include.end_date | date: "%Y" | plus: 0 -%}
      {%- assign end_month_str = include.end_date | date: "%m" -%}
      {%- assign end_month = end_month_str | plus: 0 -%}
    {%- else -%}
      {%- assign end_year = site.time | date: "%Y" | plus: 0 -%}
      {%- assign end_month_str = site.time | date: "%m" -%}
      {%- assign end_month = end_month_str | plus: 0 -%}
    {%- endif -%}
    {%- assign total_months = end_year | minus: start_year | times: 12 | plus: end_month | minus: start_month | plus: 1 -%}
    {%- if total_months >= 1 -%}
      {%- assign duration_years = total_months | divided_by: 12 -%}
      {%- assign years_in_months = duration_years | times: 12 -%}
      {%- assign remaining_months = total_months | minus: years_in_months -%}
      {%- if duration_years > 0 -%}
        {%- if remaining_months > 0 -%}
          {%- assign duration_text = duration_years | append: "y" -%}
          {%- assign duration_text = duration_text | append: " " | append: remaining_months | append: "mo" -%}
        {%- else -%}
          {%- assign duration_text = duration_years | append: "y" -%}
        {%- endif -%}
      {%- else -%}
        {%- assign duration_text = total_months | append: "mo" -%}
      {%- endif -%}
    {%- endif -%}
  {%- endif -%}
{%- endif -%}
{%- assign current_year = site.time | date: "%Y" | plus: 0 -%}
{%- assign current_month = site.time | date: "%m" | plus: 0 -%}
{%- if include.end_date -%}
  {%- assign end_year = include.end_date | date: "%Y" | plus: 0 -%}
  {%- assign end_month_str = include.end_date | date: "%m" -%}
  {%- assign end_month = end_month_str | plus: 0 -%}
  {%- if end_year > current_year -%}
    {%- assign is_ongoing = true -%}
  {%- elsif end_year == current_year and end_month >= current_month -%}
    {%- assign is_ongoing = true -%}
  {%- else -%}
    {%- assign is_ongoing = false -%}
  {%- endif -%}
{%- else -%}
  {%- assign is_ongoing = true -%}
{%- endif -%}
<span class="post-meta date-range">
  {{ include.start_date | date: date_format }}
  {% if include.end_date %}
    - <span{% if is_ongoing %} class="experience-ongoing"{% endif %}>{{ include.end_date | date: date_format }}</span>
    {% if duration_text %}
      <span class="duration-separator"> · </span><span class="duration-text">{{ duration_text }}</span>
    {% endif %}
  {% else %}
    - Present
    {% if duration_text %}
      <span class="duration-separator"> · </span><span class="duration-text">{{ duration_text }}</span>
    {% endif %}
  {% endif %}
</span>

