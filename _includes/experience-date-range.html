{%- assign date_format = site.minima.date_format | default: "%B %Y" -%}
{%- assign start_date = include.experience.start_date | date_to_xmlschema -%}
{%- assign start_epoch = include.experience.start_date | date: "%s" | plus: 0 -%}
{%- if include.experience.end_date -%}
  {%- assign end_date_parsed = include.experience.end_date | date_to_xmlschema -%}
  {%- assign end_epoch = include.experience.end_date | date: "%s" | plus: 0 -%}
{%- else -%}
  {%- assign end_epoch = site.time | date: "%s" | plus: 0 -%}
{%- endif -%}
{%- if end_epoch > 0 and start_epoch > 0 -%}
  {%- assign duration_seconds = end_epoch | minus: start_epoch -%}
  {%- if duration_seconds > 0 -%}
    {%- assign start_year = include.experience.start_date | date: "%Y" | plus: 0 -%}
    {%- assign start_month_str = include.experience.start_date | date: "%m" -%}
    {%- assign start_month = start_month_str | plus: 0 -%}
    {%- if include.experience.end_date -%}
      {%- assign end_year = include.experience.end_date | date: "%Y" | plus: 0 -%}
      {%- assign end_month_str = include.experience.end_date | date: "%m" -%}
      {%- assign end_month = end_month_str | plus: 0 -%}
    {%- else -%}
      {%- assign end_year = site.time | date: "%Y" | plus: 0 -%}
      {%- assign end_month_str = site.time | date: "%m" -%}
      {%- assign end_month = end_month_str | plus: 0 -%}
    {%- endif -%}
    {%- assign total_months = end_year | minus: start_year | times: 12 | plus: end_month | minus: start_month | plus: 1 -%}
    {%- if total_months >= 1 -%}
      {%- assign duration_years = total_months | divided_by: 12 -%}
      {%- assign years_in_months = duration_years | times: 12 -%}
      {%- assign remaining_months = total_months | minus: years_in_months -%}
      {%- if duration_years > 0 -%}
        {%- if remaining_months > 0 -%}
          {%- assign duration_text = duration_years | append: " year" -%}
          {%- if duration_years > 1 -%}
            {%- assign duration_text = duration_text | append: "s" -%}
          {%- endif -%}
          {%- assign duration_text = duration_text | append: " " | append: remaining_months | append: " month" -%}
          {%- if remaining_months > 1 -%}
            {%- assign duration_text = duration_text | append: "s" -%}
          {%- endif -%}
        {%- else -%}
          {%- assign duration_text = duration_years | append: " year" -%}
          {%- if duration_years > 1 -%}
            {%- assign duration_text = duration_text | append: "s" -%}
          {%- endif -%}
        {%- endif -%}
      {%- else -%}
        {%- assign duration_text = total_months | append: " month" -%}
        {%- if total_months > 1 -%}
          {%- assign duration_text = duration_text | append: "s" -%}
        {%- endif -%}
      {%- endif -%}
    {%- endif -%}
  {%- endif -%}
{%- endif -%}
{%- if include.wrapper == 'time' -%}
  <time class="dt-published" datetime="{{ start_date }}" itemprop="datePublished">
    {{ start_date | date: date_format }}
    {% if include.experience.end_date %}
      - {{ include.experience.end_date | date: date_format }}
      {% if duration_text %}
        <span class="duration-separator"> 路 </span><span class="duration-text">{{ duration_text }}</span>
      {% endif %}
    {% else %}
      - Present
      {% if duration_text %}
        <span class="duration-separator"> 路 </span><span class="duration-text">{{ duration_text }}</span>
      {% endif %}
    {% endif %}
  </time>
{%- else -%}
  <span class="post-meta">
    {{ include.experience.start_date | date: date_format }}
    {% if include.experience.end_date %}
      - {{ include.experience.end_date | date: date_format }}
      {% if duration_text %}
        <span class="duration-separator"> 路 </span><span class="duration-text">{{ duration_text }}</span>
      {% endif %}
    {% else %}
      - Present
      {% if duration_text %}
        <span class="duration-separator"> 路 </span><span class="duration-text">{{ duration_text }}</span>
      {% endif %}
    {% endif %}
  </span>
{%- endif -%}

